namespace = KoH_holy_orders

#Title Cleanup
#Templar Holdings
KoH_holy_orders.1 = {
	type = character_event
	title = KoH_holy_orders.1.t
	desc = KoH_holy_orders.1.d
	theme = war
	hidden = yes
	

	left_portrait = {
		character = root
		animation = personality_bold
	}
	
	immediate = {
		every_living_character = {
			limit = {
				any_held_title = {
					this = title:d_knights_templar
				}
			}
			save_scope_as = leader
		}
	}
	
	option = {
		name = KoH_holy_orders.1.a
		
		hidden_effect = {
			if = {
				limit = { NOT = { title:b_toron.holder = scope:leader } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				title:b_toron = {
					change_title_holder_include_vassals = {
						holder = scope:leader
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}

		create_holy_order = {
			leader = scope:leader
			capital = title:b_toron
			save_scope_as = templar_holy_order
		}
		
		hidden_effect = {
			scope:leader = {
				add_gold = 100 #So that they have some money to lend out
				add_piety_level = 2
				add_gold = holy_order_starting_gold
				every_courtier = {
					add_trait = order_member
				}
			}
		}
		templar_holy_order = {
			copy_title_history = title:d_knights_templars
		}
	}
}

#Beaufort
KoH_holy_orders.4 = {
	type = character_event
	title = KoH_holy_orders.4.t
	desc = KoH_holy_orders.4.d
	theme = war
	hidden = yes

	immediate = {
		faith = {
			random_faith_holy_order = {
				limit = {
					leader = {
						this = character:231001
					}
				}
				save_scope_as = holy_order
			}
		}
		title:b_beaufort = {
			lease_out_to = scope:holy_order
		}
	}
}

#Hospitaler Cleanup
KoH_holy_orders.2 = {
	type = character_event
	title = KoH_holy_orders.2.t
	desc = KoH_holy_orders.2.d
	theme = war
	hidden = yes

	left_portrait = {
		character = root
		animation = personality_bold
	}
	
	immediate = {
		every_living_character = {
			limit = {
				any_held_title = {
					this = title:d_knights_hospitaler
				}
			}
			save_scope_as = leader
		}
		hidden_effect = {
			if = {
				limit = { NOT = { title:b_bethgibelin.holder = scope:leader } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				title:b_bethgibelin = {
					change_title_holder_include_vassals = {
						holder = scope:leader
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}

		create_holy_order = {
			leader = scope:leader
			capital = title:b_bethgibelin
			save_scope_as = hospitaler_holy_order
		}
	
		hidden_effect = {
			scope:leader = {
				add_gold = 100 #So that they have some money to lend out
				add_piety_level = 2
				add_gold = holy_order_starting_gold
				every_courtier = {
					add_trait = order_member
				}
			}
		}
		templar_holy_order = {
			copy_title_history = title:d_knights_hospitaler
		}  
	}
}
#Kerake for hospitaler WILL NOT WORK UNTIL NEW BARONY
KoH_holy_orders.3 = {
	type = character_event
	title = KoH_holy_orders.3.t
	desc = KoH_holy_orders.3.d
	theme = war
	hidden = yes

	immediate = {
		faith = {
			random_faith_holy_order = {
				limit = {
					leader = {
						this = character:231001
					}
				}
				save_scope_as = holy_order1
			}
		}
		title:c_kerake = {
			lease_out_to = scope:holy_order1
		}
	}
}

#Setting up Knights of Calatrava
KoH_holy_orders.5 = {
	type = character_event
	title = KoH_holy_orders.5.t
	desc = KoH_holy_orders.5.d
	theme = war
	hidden = yes

	left_portrait = {
		character = root
		animation = personality_bold
	}
	
	immediate = {
		every_living_character = {
			limit = {
				any_held_title = {
					this = title:d_knights_calatrava
				}
			}
			save_scope_as = leader #73153 #207510
		}
		hidden_effect = {
			if = {
				limit = { NOT = { title:b_mentesa.holder = scope:leader } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				title:b_mentesa = {
					change_title_holder_include_vassals = {
						holder = scope:leader
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}

		create_holy_order = {
			leader = scope:leader
			capital = title:b_mentesa
			save_scope_as = calatrava_holy_order
		}
	
		hidden_effect = {
			scope:leader = {
				add_gold = 100 #So that they have some money to lend out
				add_piety_level = 2
				add_gold = holy_order_starting_gold
				every_courtier = {
					add_trait = order_member
				}
			}
		}
		calatrava_holy_order = {
			copy_title_history = title:d_knights_calatrava
		}
	}
}
#Setting Up Knights of Santiago 
KoH_holy_orders.6 = {
	type = character_event
	title = KoH_holy_orders.6.t
	desc = KoH_holy_orders.6.d
	theme = war
	hidden = yes

	left_portrait = {
		character = root
		animation = personality_bold
	}
	
	immediate = {
		create_character = {
			template = holy_order_leader_character
			location = 1953
			save_scope_as = leader
		}
		hidden_effect = {
			if = {
				limit = { NOT = { title:b_mora.holder = scope:leader } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				title:b_mora = {
					change_title_holder_include_vassals = {
						holder = scope:leader
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}
		create_holy_order = {
			leader = scope:leader
			capital = title:b_mora
			save_scope_as = calatrava_holy_order
		}
	
		hidden_effect = {
			scope:leader = {
				add_gold = 100 #So that they have some money to lend out
				add_piety_level = 2
				add_gold = holy_order_starting_gold
				every_courtier = {
					add_trait = order_member
				}
			}
		}
	}
}

#AGE OF CRUSADES AND JIHADS
KoH_holy_orders.100 = { 
	type = character_event
	title = KoH_holy_orders.100.t
	desc = KoH_holy_orders.100.d
	theme = war
	hidden = yes
	
	immediate = {
		faith:ashari = {
			change_fervor = 200
			save_scope_as = awakening_faith
			if = {
				limit = {
					exists = religious_head
				}
				religious_head = { save_scope_as = ghw_first_sponsor }
			}
			else = {
				random_theocratic_ruler = {
					limit = { faith = root }
					save_scope_as = ghw_first_sponsor
				}
			}
			if = { # Fallback
				limit = {
					NOT = {
						exists = scope:ghw_first_sponsor
					}
				}
				random_ruler = {
					limit = { faith = root }
					save_scope_as = ghw_first_sponsor
				}
			}
			religion = {
				set_variable = {
					name = variable_ghw_unlocked # Crusades
					value = yes
				}
			}
		}	
	}
}
#AGE OF CRUSADES, WILL DELAY
KoH_holy_orders.101 = { 
	type = character_event
	title = KoH_holy_orders.101.t
	desc = KoH_holy_orders.101.d
	theme = war
	hidden = yes
	
	trigger = { 
		if = {
			limit = { 
				title:c_jerusalem.holder = {
				NOT = { faith.religion = religion:christianity_religion }
			}
		}
	}
}

	immediate = {
		faith:catholic = {
			change_fervor = 200
			save_scope_as = awakening_faith
			if = {
				limit = {
					exists = religious_head
				}
				religious_head = { save_scope_as = ghw_first_sponsor }
			}
			else = {
				random_theocratic_ruler = {
					limit = { faith = root }
					save_scope_as = ghw_first_sponsor
				}
			}
			if = { # Fallback
				limit = {
					NOT = {
						exists = scope:ghw_first_sponsor
					}
				}
				random_ruler = {
					limit = { faith = root }
					save_scope_as = ghw_first_sponsor
				}
			}
			religion = {
				set_variable = {
					name = variable_ghw_unlocked # Crusades
					value = yes
				}
			}
		}
	}
}