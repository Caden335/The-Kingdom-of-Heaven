change_chivalry_effect = {
	hidden_effect = {
		if = {
			limit = {
			NOT = { exists = var:Chivalry }
			}
			set_variable = {
				name = Chivalry
				value = 0
			}
		}
		change_variable = { name = Chivalry add = $Chivalry$ }
		if = {
			limit = {
				var:Chivalry > 10
			}
			set_variable = {
				name = Chivalry
				value = 10
			}
		}
		else_if = {
			limit = {
				var:Chivalry < 0
			}
			set_variable = {
				name = Chivalry
				value = 0
			}
		}
		set_variable = {
			name = total_opinion
			value = var:Chivalry
		}
		change_variable = {
			name = total_opinion
			multiply = 2
		}
		set_variable = {
			name = total_prestige
			value = var:Chivalry
		}
		change_variable = {
			name = total_prestige
			divide = 5
		}
		set_variable = {
			name = total_dread_loss
			value = var:Chivalry
		}
		change_variable = {
			name = total_dread_loss
			multiply = 10
		}
		if = {
			limit = {
				var:Chivalry = 0
			}
			add_character_modifier = {
				modifier = chivalry
				days = -1
			}
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 1
			}
			add_character_modifier = {
				modifier = chivalry_1
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 2
			}
			add_character_modifier = {
				modifier = chivalry_2
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 3
			}
			add_character_modifier = {
				modifier = chivalry_3
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 4
			}
			add_character_modifier = {
				modifier = chivalry_4
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 5
			}
			add_character_modifier = {
				modifier = chivalry_5
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 6
			}
			add_character_modifier = {
				modifier = chivalry_6
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 7
			}
			add_character_modifier = {
				modifier = chivalry_7
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 8
			}
			add_character_modifier = {
				modifier = chivalry_8
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 9
			}
			add_character_modifier = {
				modifier = chivalry_9
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_1
			remove_character_modifier = chivalry_10
		}
		else_if = {
			limit = {
				var:Chivalry = 10
			}
			add_character_modifier = {
				modifier = chivalry_10
				days = -1
			}
			remove_character_modifier = chivalry
			remove_character_modifier = chivalry_2
			remove_character_modifier = chivalry_3
			remove_character_modifier = chivalry_4
			remove_character_modifier = chivalry_5
			remove_character_modifier = chivalry_6
			remove_character_modifier = chivalry_7
			remove_character_modifier = chivalry_8
			remove_character_modifier = chivalry_9
			remove_character_modifier = chivalry_1
		}
	}
}

add_my_faction ={
	root = {
	set_variable = {
		name = claiming_title
		value = title:k_england
	}

	if = {
		limit = {
			can_create_faction = {
				type = claimant_faction
				target = title:k_england.holder
			}
		}

		create_faction = {
			type = claimant_faction
			target = title:k_england.holder
		}
		joined_faction = {
			set_special_character = root
			set_special_title = title:k_england
		}
		title:k_england.holder = {
			add_to_variable_list = {
				name = claimant_factions
				target = root.joined_faction
			}
		}

		if = {
			limit = { NOT = { this = title:k_england.holder } }
			save_scope_as = faction_invite_from
			joined_faction = { save_scope_as = faction }
			title:k_england.holder = { save_scope_as = faction_target }
			#title:k_england.holder = {
			#	trigger_event = faction_invitation.0001
			#}
		}
	}

	remove_variable = claiming_title
}
}

MothersFaction ={
	title:c_poitiers.holder = {
	set_variable = {
		name = claiming_title
		value = title:d_aquitaine
	}

	if = {
		limit = {
			can_create_faction = {
				type = claimant_faction
				target = title:d_aquitaine.holder
			}
		}

		create_faction = {
			type = claimant_faction
			target = title:d_aquitaine.holder
		}
		joined_faction = {
			set_special_character = title:c_poitiers.holder
			set_special_title = title:d_aquitaine
		}
		title:d_aquitaine.holder = {
			add_to_variable_list = {
				name = claimant_factions
				target = title:c_poitiers.holder.joined_faction
			}
		}

		if = {
			limit = { NOT = { this = title:d_aquitaine.holder } }
			save_scope_as = faction_invite_from
			joined_faction = { save_scope_as = faction }
			title:d_aquitaine.holder = { save_scope_as = faction_target }
			#title:d_aquitaine.holder = {
				#trigger_event = faction_invitation.0001
			#}
		}
	}

	remove_variable = claiming_title
}
}

KOH_HungaryHungary = {
	title:k_hungary.holder = {
		create_title_and_vassal_change = {
			type = conquest
			save_scope_as = change
			add_claim_on_loss = yes
		}
		
		# Transfer landed titles to the attacker.
		setup_claim_cb = {
			titles = target_titles
			attacker = scope:attacker
			defender = scope:defender
			claimant = scope:claimant
			change = scope:change
		}
		
		title:c_szerem = {	
			add_to_list = target_titles
		}
		title:c_macva = {
				add_to_list = target_titles
		}
		title:c_beograd = {
				add_to_list = target_titles
			}
		title:c_branicevo = {
				add_to_list = target_titles
		}			

		every_in_list = {
			list = target_titles
			change_title_holder = {
				holder = title:k_hungary.holder
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
	}
	
	if = {
		limit = {
			character:218500 = {
				AND = {
					this = title:k_serbia.holder
					is_alive = yes
					is_pool_character = no
					}
				}
			}
			title:c_sumadija = {	
					add_to_list = serbia_reward_titles
			}
			title:c_pomoravlje = {
					add_to_list = serbia_reward_titles
			}
			title:c_hvosno = {
					add_to_list = serbia_reward_titles
			}
			create_title_and_vassal_change = {
				type = conquest
				save_scope_as = change
				add_claim_on_loss = no
			}
			every_in_list = {
				list = serbia_reward_titles
				change_title_holder = {
					holder = character:218500
					change = scope:change
				}
			}
		resolve_title_and_vassal_change = scope:change
	}
}
	


KOH_Saladin_Jihad = {
	
	set_global_variable = {
		name = SaladinHasTakenJerusalem
		value = yes
	}
	
	title:c_tripoli.holder = {
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change1
			add_claim_on_loss = yes
		}
		becomes_independent = { 
			change = scope:change1
		}
		resolve_title_and_vassal_change = scope:change1
	}
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
		add_claim_on_loss = yes
	}
	setup_claim_cb = {
		titles = target_titles
		attacker = scope:attacker
		defender = scope:defender
		claimant = scope:claimant
		change = scope:change
	}
	title:c_maab = {	
			add_to_list = target_titles
	}
	title:c_kerak = {
			add_to_list = target_titles
	}
	title:c_negev = {
			add_to_list = target_titles
	}
	title:c_jerusalem = {
			add_to_list = target_titles
	}	
	title:c_maab = {	
			add_to_list = target_titles
	}
	title:c_ghazza = {
			add_to_list = target_titles
	}
	title:c_ibelin = {
			add_to_list = target_titles
	}
	title:c_jaffa = {
			add_to_list = target_titles
	}	
	title:c_irbid = {	
			add_to_list = target_titles
	}
	title:c_tiberias = {
			add_to_list = target_titles
	}
	title:c_torone = {
			add_to_list = target_titles
	}
	title:c_beirut = {
			add_to_list = target_titles
	}			
	every_in_list = {
		list = target_titles
		change_title_holder = {
			holder = character:226000
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

KOH_Crusade_Win = {
	
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
		add_claim_on_loss = yes
	}
	setup_claim_cb = {
		titles = target_titles
		attacker = scope:attacker
		defender = scope:defender
		claimant = scope:claimant
		change = scope:change
	}
	title:c_maab = {	
			add_to_list = target_titles
	}
	title:c_kerak = {
			add_to_list = target_titles
	}
	title:c_negev = {
			add_to_list = target_titles
	}
	title:c_jerusalem = {
			add_to_list = target_titles
	}	
	title:c_maab = {	
			add_to_list = target_titles
	}
	title:c_ghazza = {
			add_to_list = target_titles
	}
	title:c_ibelin = {
			add_to_list = target_titles
	}
	title:c_jaffa = {
			add_to_list = target_titles
	}	
	title:c_irbid = {	
			add_to_list = target_titles
	}
	title:c_tiberias = {
			add_to_list = target_titles
	}
	title:c_torone = {
			add_to_list = target_titles
	}
	title:c_beirut = {
			add_to_list = target_titles
	}			
	every_in_list = {
		list = target_titles
		change_title_holder = {
			holder = title:k_jerusalem.holder
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

KOH_Crusade_WhitePeace_Winning = {
	
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
		add_claim_on_loss = yes
	}
	setup_claim_cb = {
		titles = target_titles
		attacker = scope:attacker
		defender = scope:defender
		claimant = scope:claimant
		change = scope:change
	}
	title:c_ghazza = {
			add_to_list = target_titles
	}
	title:c_ibelin = {
			add_to_list = target_titles
	}
	title:c_jaffa = {
			add_to_list = target_titles
	}	
		
	every_in_list = {
		list = target_titles
		change_title_holder = {
			holder = title:k_jerusalem.holder
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

KOH_Crusade_lose = {
	
	create_title_and_vassal_change = {
		type = conquest
		save_scope_as = change
		add_claim_on_loss = yes
	}
	setup_claim_cb = {
		titles = target_titles
		attacker = scope:attacker
		defender = scope:defender
		claimant = scope:claimant
		change = scope:change
	}
	title:c_acre = {
			add_to_list = target_titles
	}
	title:c_tiberias = {
			add_to_list = target_titles
	}			
	every_in_list = {
		list = target_titles
		change_title_holder = {
			holder = character:226000
			change = scope:change
		}
	}
	resolve_title_and_vassal_change = scope:change
}

